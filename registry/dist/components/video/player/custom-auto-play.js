!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports["video/player/custom-auto-play"]=e():t["video/player/custom-auto-play"]=e()}(globalThis,(()=>(()=>{var t,e,r={834:t=>{function e(t){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}e.keys=()=>[],e.resolve=e,e.id=834,t.exports=e},397:t=>{"use strict";t.exports="定制自动连播行为，可根据自动连播视频类型分别配置\n\n---\n\n自动连播行为：\n\n- 自动：类似 `传统连播模式`，区别是多P视频包括番剧，具体如下\n  - 推荐视频都不自动连播\n  - 多P视频（番剧、多P列表、收藏夹等）连播到最后1P停止\n- 禁用：不自动连播\n- 总是：总是自动连播，具体由B站本身决定，如 `分p视频` 会自动连播推荐视频，但 `番剧` 会到最后1集停止\n\n---\n\n优先级说明：\n\n目前只有 `推荐视频（列表第一个）` 会和其他类型同时出现，`推荐视频（列表第一个）` 的优先级是最低的，并且需要设置为 `总是` 且其他匹配类型不是 `总是` 时才会生效\n\n下面举例说明当 `推荐视频（列表第一个）` 为 `总是` 时，其他类型的设置及最终联动行为：\n\n| 设置 | 分P视频 |\n| :--- | :--- |\n| `自动` | 连播下一P，播完所有P后连播推荐视频 |\n| `禁用` | 当前分P播放完后自动连播推荐视频 |\n| `总是` | 保持分p视频类型原行为，具体参考 `自动连播行为` 中的说明 |\n"}},n={};function o(t){var e=n[t];if(void 0!==e)return e.exports;var i=n[t]={exports:{}};return r[t](i,i.exports,o),i.exports}e=Object.getPrototypeOf?t=>Object.getPrototypeOf(t):t=>t.__proto__,o.t=function(r,n){if(1&n&&(r=this(r)),8&n)return r;if("object"==typeof r&&r){if(4&n&&r.__esModule)return r;if(16&n&&"function"==typeof r.then)return r}var i=Object.create(null);o.r(i);var u={};t=t||[null,e({}),e([]),e(e)];for(var a=2&n&&r;"object"==typeof a&&!~t.indexOf(a);a=e(a))Object.getOwnPropertyNames(a).forEach((t=>u[t]=()=>r[t]));return u.default=()=>r,o.d(i,u),i},o.d=(t,e)=>{for(var r in e)o.o(e,r)&&!o.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),o.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var i={};return(()=>{"use strict";o.d(i,{component:()=>q,v:()=>O});const t=coreApis.componentApis.define,e=coreApis.utils.urls,r=coreApis.utils.log,n=coreApis.spinQuery,u=coreApis.utils,a=coreApis.settings,s=coreApis.observer;let l=function(t){return t.AUTO="自动",t.DISABLE="禁用",t.ALWAYS="总是",t}({});function c(t,e,r){return(e=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}class p{constructor(){c(this,"type",void 0)}static register(t){p.handlers.push(t)}static async getHandlers(){const t=[];for(const e of p.handlers)await e.match()&&t.push(e);return t}static shouldAutoplayWithAutoHandler(t,e){switch(t){case l.ALWAYS:return!0;case l.DISABLE:return!1;case l.AUTO:default:return e()}}getSequentialNumberString(){return""}parseSequentialNumbers(){return this.getSequentialNumberString().replace(/[（）()]/g,"").split("/").map((t=>parseInt(t)))}isLastSequentialNumber(){const t=this.parseSequentialNumbers();return!t||t.length<2||t[0]>=t[1]}async setupAutoPlay_SwitchBtn(t){(0,n.sq)((()=>{try{const e=document.getElementById("app");return(0,u.getVue2Data)(e).setContinuousPlay(t),!0}catch(t){return O.debug(`${this.constructor.name}：设置自动连播按钮状态发生错误，错误信息：${t}`),!1}}))}async setupAutoPlay_Player(t){const e=t?'.bpx-player-ctrl-setting-handoff input[type="radio"][value="0"]':'.bpx-player-ctrl-setting-handoff input[type="radio"][value="2"]',r=await(0,n.select)(e);null===r&&O.error(`${this.constructor.name}：未找到对应的播放方式按钮`),r.click()}}function y(t,e,r){return(e=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}c(p,"settings",void 0),c(p,"handlers",[]);class m extends p{constructor(){super(...arguments),y(this,"type","番剧")}async match(){return e.bangumiUrls.some((t=>(0,u.matchUrlPattern)(t)))}getSequentialNumberString(){return document.querySelector(".plp-r span[class^=eplist_ep_list_progress]").innerHTML}isLastSequentialNumber(){if(this.getSequentialNumberString().length>0)return super.isLastSequentialNumber();return!document.querySelector(".plp-r img[class^=PlayingIcon_playIcon]").closest("div[class^=imageListItem_wrap]").nextElementSibling}async shouldAutoplay(){return p.shouldAutoplayWithAutoHandler(p.settings.options.bangumiAutoplayAction,(()=>!this.isLastSequentialNumber()))}async setupAutoPlay(t){await this.setupAutoPlay_Player(t)}}function d(t,e,r){return(e=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}class f extends p{constructor(){super(...arguments),d(this,"type","收藏夹")}async match(){return e.favoriteListUrls.some((t=>(0,u.matchUrlPattern)(t)))}getSequentialNumberString(){return document.querySelector(".list-count").innerHTML}async shouldAutoplay(){return p.shouldAutoplayWithAutoHandler(p.settings.options.favoriteAutoplayAction,(()=>!this.isLastSequentialNumber()))}async setupAutoPlay(t){await this.setupAutoPlay_SwitchBtn(t)}}function b(t,e,r){return(e=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}class h extends p{constructor(){super(...arguments),b(this,"type","视频合集")}async match(){const t=document.querySelector(".video-pod .section"),e=document.querySelector(".video-pod .auto-play .switch-btn");return(0,u.matchUrlPattern)("//www.bilibili.com/video/")&&null!=t&&null!=e}getSequentialNumberString(){return document.querySelector(".video-pod__header .amt").innerHTML}async shouldAutoplay(){return p.shouldAutoplayWithAutoHandler(p.settings.options.playlistAutoplayAction,(()=>!this.isLastSequentialNumber()))}async setupAutoPlay(t){await this.setupAutoPlay_SwitchBtn(t)}}function v(t,e,r){return(e=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}class g extends p{constructor(){super(...arguments),v(this,"type","推荐视频（接下来播放）")}async match(){const t=document.querySelector(".recommend-list-v1 .switch-btn");return(0,u.matchUrlPattern)("//www.bilibili.com/video/")&&null!==t}async shouldAutoplay(){return p.shouldAutoplayWithAutoHandler(p.settings.options.recommendAutoplayAction,(()=>!1))}async setupAutoPlay(t){await this.setupAutoPlay_SwitchBtn(t)}}function A(t,e,r){return(e=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}class w extends p{constructor(){super(...arguments),A(this,"type","稍后再看")}async match(){return e.watchlaterUrls.some((t=>(0,u.matchUrlPattern)(t)))}getSequentialNumberString(){return document.querySelector(".list-count").innerHTML}async shouldAutoplay(){return p.shouldAutoplayWithAutoHandler(p.settings.options.watchLaterAutoplayAction,(()=>!this.isLastSequentialNumber()))}async setupAutoPlay(t){await this.setupAutoPlay_SwitchBtn(t)}}function P(t,e,r){return(e=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}class S extends p{constructor(){super(...arguments),P(this,"type","分P视频")}async match(){const t=document.querySelector(".video-pod .multip"),e=document.querySelector(".video-pod .auto-play .switch-btn");return(0,u.matchUrlPattern)("//www.bilibili.com/video/")&&null!=t&&null!=e}getSequentialNumberString(){return document.querySelector(".video-pod__header .amt").innerHTML}async shouldAutoplay(){return p.shouldAutoplayWithAutoHandler(p.settings.options.multipartAutoplayAction,(()=>!this.isLastSequentialNumber()))}async setupAutoPlay(t){await this.setupAutoPlay_SwitchBtn(t)}}function j(t,e,r){return(e=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}class N extends p{constructor(){super(...arguments),j(this,"type","推荐视频（列表第一个）"),j(this,"onVideoEnded",(()=>{const t=this.getFirstRecommend();window.location.assign(t.getAttribute("href"))}))}async match(){let t=(0,u.matchUrlPattern)("//www.bilibili.com/video/");return t=t||e.bangumiUrls.some((t=>(0,u.matchUrlPattern)(t))),t=t||e.favoriteListUrls.some((t=>(0,u.matchUrlPattern)(t))),t=t||e.watchlaterUrls.some((t=>(0,u.matchUrlPattern)(t))),t&&null!==this.getFirstRecommend()}async shouldAutoplay(){return p.shouldAutoplayWithAutoHandler(p.settings.options.recommendListAutoplayAction,(()=>!1))}async setupAutoPlay(t){const e=document.querySelector("video");e&&(t?e.addEventListener("ended",this.onVideoEnded,{once:!0}):e.removeEventListener("ended",this.onVideoEnded))}getFirstRecommend(){return document.querySelector(".rec-list .pic a,.recommend-list-container .pic-box a,.plp-r div[class^=RecommendItem_wrap] a")}}const O=(0,r.useScopedConsole)("定制自动连播行为"),q=(0,t.defineComponentMetadata)({name:"customAutoPlay",displayName:"定制自动连播行为",tags:[componentsTags.video],urlInclude:[...e.videoUrls,...e.bangumiUrls],entry:async t=>{let{metadata:e,settings:r}=t;async function o(){await(0,u.playerReady)();const t=await p.getHandlers();if(0===t.length)return void O.warn("未找到匹配的自动播放处理器");O.log(`导航变化（${document.URL}），重新初始化脚本`);let e=null;const r=[];for(const n of t){const t=await n.shouldAutoplay();if(t){if(null===e){O.log(`自动连播类型：${n.type}\n是否应该自动连播：${t}`),e=n;continue}O.log(`自动连播类型：${n.type}\n是否应该自动连播：${t}，已有启用的连播类型，自动设置为不连播`)}else O.log(`自动连播类型：${n.type}\n是否应该自动连播：${t}`);r.push(n)}for(const t of r)await t.setupAutoPlay(!1);await(e?.setupAutoPlay(!0))}p.register(new m),p.register(new f),p.register(new S),p.register(new h),p.register(new w),p.register(new g),p.register(new N),p.settings=r;const i=lodash.debounce(o,1e3),l=await Promise.any([(0,n.select)(".right-container-inner"),(0,n.select)(".playlist-container--right"),(0,n.select)(".plp-r")]);l?((0,s.childListSubtree)(l,(()=>{i()})),Object.keys(r.options).forEach((t=>{(0,a.addComponentListener)(`${e.name}.${t}`,(async()=>{await o()}),!0)}))):O.warn("未找到 rightPanelContainer 或 playListContainer")},options:{bangumiAutoplayAction:{displayName:"自动连播行为-番剧",defaultValue:l.ALWAYS,dropdownEnum:l},favoriteAutoplayAction:{displayName:"自动连播行为-收藏夹",defaultValue:l.AUTO,dropdownEnum:l},multipartAutoplayAction:{displayName:"自动连播行为-分p视频",defaultValue:l.AUTO,dropdownEnum:l},playlistAutoplayAction:{displayName:"自动连播行为-视频合集",defaultValue:l.AUTO,dropdownEnum:l},watchLaterAutoplayAction:{displayName:"自动连播行为-稍后再看",defaultValue:l.AUTO,dropdownEnum:l},recommendAutoplayAction:{displayName:"自动连播行为-推荐视频（接下来播放）",defaultValue:l.AUTO,dropdownEnum:l},recommendListAutoplayAction:{displayName:"自动连播行为-推荐视频（列表第一个）",defaultValue:l.AUTO,dropdownEnum:l}},commitHash:"a787f5e0b650972fa61966c981de0f27cbceed21",coreVersion:"2.10.5",description:(()=>{const t=o(834);return{...Object.fromEntries(t.keys().map((e=>[e.match(/index\.(.+)\.md$/)[1],t(e)]))),"zh-CN":()=>Promise.resolve().then(o.t.bind(o,397,17)).then((t=>t.default))}})()})})(),i=i.component})()));