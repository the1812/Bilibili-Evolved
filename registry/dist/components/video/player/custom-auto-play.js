!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports["video/player/custom-auto-play"]=e():t["video/player/custom-auto-play"]=e()}(globalThis,(()=>(()=>{var t,e,n={834:t=>{function e(t){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e}e.keys=()=>[],e.resolve=e,e.id=834,t.exports=e},397:t=>{"use strict";t.exports="定制自动连播行为，可根据自动连播视频类型分别配置\n\n---\n\n自动连播行为：\n\n- 自动：类似 `传统连播模式`，区别是多P视频包括番剧，具体如下\n  - 单P视频放完禁止连播其他推荐视频\n  - 多P视频（番剧、多P列表、收藏夹等）连播到最后1P停止\n- 禁用：不自动连播\n- 总是：总是自动连播\n"}},r={};function o(t){var e=r[t];if(void 0!==e)return e.exports;var a=r[t]={exports:{}};return n[t](a,a.exports,o),a.exports}e=Object.getPrototypeOf?t=>Object.getPrototypeOf(t):t=>t.__proto__,o.t=function(n,r){if(1&r&&(n=this(n)),8&r)return n;if("object"==typeof n&&n){if(4&r&&n.__esModule)return n;if(16&r&&"function"==typeof n.then)return n}var a=Object.create(null);o.r(a);var s={};t=t||[null,e({}),e([]),e(e)];for(var i=2&r&&n;"object"==typeof i&&!~t.indexOf(i);i=e(i))Object.getOwnPropertyNames(i).forEach((t=>s[t]=()=>n[t]));return s.default=()=>n,o.d(a,s),a},o.d=(t,e)=>{for(var n in e)o.o(e,n)&&!o.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),o.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var a={};return(()=>{"use strict";o.d(a,{component:()=>m});const t=coreApis.componentApis.define,e=coreApis.utils.urls,n=coreApis.utils.log,r=coreApis.spinQuery,s=coreApis.utils,i=coreApis.componentApis.feeds.api,u=coreApis.settings,l=coreApis.observer;function c(t,e,n){return(e=function(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const p=(0,n.useScopedConsole)("定制自动连播行为");var y=function(t){return t.AUTO="自动",t.DISABLE="禁用",t.ALWAYS="总是",t}(y||{});class d{constructor(){c(this,"type",void 0)}static register(t){d.handlers.push(t)}static async getHandler(){for(const t of d.handlers)if(await t.match())return t;return null}static shouldAutoplayWithAutoHandler(t,e){switch(t){case y.ALWAYS:return!0;case y.DISABLE:return!1;case y.AUTO:default:return e()}}getSequentialNumberString(){return""}parseSequentialNumbers(){return this.getSequentialNumberString().replace(/[（）()]/g,"").split("/").map((t=>parseInt(t)))}isLastSequentialNumber(){const t=this.parseSequentialNumbers();return!t||t.length<2||t[0]>=t[1]}async setupAutoPlay_SwitchBtn(t){(0,r.sq)((()=>{try{const e=document.getElementById("app");return(0,i.getVueData)(e).setContinuousPlay(t),!0}catch(t){return p.debug(`${this.constructor.name}：设置自动连播按钮状态发生错误，错误信息：${t}`),!1}}))}async setupAutoPlay_Player(t){const e=t?'.bpx-player-ctrl-setting-handoff input[type="radio"][value="0"]':'.bpx-player-ctrl-setting-handoff input[type="radio"][value="2"]',n=await(0,r.select)(e);null===n&&p.error(`${this.constructor.name}：未找到对应的播放方式按钮`),n.click()}}c(d,"settings",void 0),c(d,"handlers",[]);d.register(new class extends d{constructor(){super(...arguments),c(this,"type","番剧")}async match(){return e.bangumiUrls.some((t=>(0,s.matchUrlPattern)(t)))}isLastSequentialNumber(){return!document.querySelector(".plp-r img[class^=PlayingIcon_playIcon]").closest("div[class^=imageListItem_wrap]").nextElementSibling}async shouldAutoplay(){return d.shouldAutoplayWithAutoHandler(d.settings.options.bangumiAutoplayAction,(()=>!this.isLastSequentialNumber()))}async setupAutoPlay(t){await this.setupAutoPlay_Player(t)}});d.register(new class extends d{constructor(){super(...arguments),c(this,"type","推荐视频")}async match(){const t=document.querySelector(".recommend-list-v1 .switch-btn");return(0,s.matchUrlPattern)("//www.bilibili.com/video/")&&null!==t}async shouldAutoplay(){return d.shouldAutoplayWithAutoHandler(d.settings.options.recommendAutoplayAction,(()=>!1))}async setupAutoPlay(t){await this.setupAutoPlay_SwitchBtn(t)}});d.register(new class extends d{constructor(){super(...arguments),c(this,"type","稍后再看")}async match(){return e.watchlaterUrls.some((t=>(0,s.matchUrlPattern)(t)))}getSequentialNumberString(){return document.querySelector(".list-count").innerHTML}async shouldAutoplay(){return d.shouldAutoplayWithAutoHandler(d.settings.options.watchLaterAutoplayAction,(()=>!this.isLastSequentialNumber()))}async setupAutoPlay(t){await this.setupAutoPlay_SwitchBtn(t)}});d.register(new class extends d{constructor(){super(...arguments),c(this,"type","分P视频")}async match(){const t=document.querySelector(".video-pod .auto-play .switch-btn");return(0,s.matchUrlPattern)("//www.bilibili.com/video/")&&null!==t}getSequentialNumberString(){return document.querySelector(".video-pod__header .amt").innerHTML}async shouldAutoplay(){return d.shouldAutoplayWithAutoHandler(d.settings.options.playlistAutoplayAction,(()=>!this.isLastSequentialNumber()))}async setupAutoPlay(t){await this.setupAutoPlay_SwitchBtn(t)}});d.register(new class extends d{constructor(){super(...arguments),c(this,"type","收藏夹")}async match(){return e.favoriteListUrls.some((t=>(0,s.matchUrlPattern)(t)))}getSequentialNumberString(){return document.querySelector(".list-count").innerHTML}async shouldAutoplay(){return d.shouldAutoplayWithAutoHandler(d.settings.options.favoriteAutoplayAction,(()=>!this.isLastSequentialNumber()))}async setupAutoPlay(t){await this.setupAutoPlay_SwitchBtn(t)}});const m=(0,t.defineComponentMetadata)({name:"customAutoPlay",displayName:"定制自动连播行为",tags:[componentsTags.video],urlInclude:[...e.videoUrls,...e.bangumiUrls],entry:async t=>{let{metadata:e,settings:n}=t;async function o(){await(0,s.playerReady)();const t=await d.getHandler();if(!t)return void p.warn("未找到匹配的自动播放处理器");const e=await t.shouldAutoplay();p.log(`导航变化（${document.URL}），重新初始化脚本\n自动连播类型：${t.type}\n是否应该自动连播：${e}`),await t.setupAutoPlay(e)}d.settings=n;const a=lodash.debounce(o,1e3),i=await Promise.any([(0,r.select)(".right-container-inner"),(0,r.select)(".playlist-container--right"),(0,r.select)(".plp-r")]);i?((0,l.childListSubtree)(i,(()=>{a()})),Object.keys(n.options).forEach((t=>{(0,u.addComponentListener)(`${e.name}.${t}`,(async()=>{await o()}),!0)}))):p.warn("未找到 rightPanelContainer 或 playListContainer")},options:{bangumiAutoplayAction:{displayName:"自动连播行为-番剧",defaultValue:y.ALWAYS,dropdownEnum:y},recommendAutoplayAction:{displayName:"自动连播行为-推荐视频",defaultValue:y.AUTO,dropdownEnum:y},watchLaterAutoplayAction:{displayName:"自动连播行为-稍后再看",defaultValue:y.AUTO,dropdownEnum:y},playlistAutoplayAction:{displayName:"自动连播行为-分p视频",defaultValue:y.AUTO,dropdownEnum:y},favoriteAutoplayAction:{displayName:"自动连播行为-收藏夹",defaultValue:y.AUTO,dropdownEnum:y}},commitHash:"c2a3ec9c33f2b153d78ebe47ea2fd6e76e040032",coreVersion:"2.10.4",description:(()=>{const t=o(834);return{...Object.fromEntries(t.keys().map((e=>[e.match(/index\.(.+)\.md$/)[1],t(e)]))),"zh-CN":()=>Promise.resolve().then(o.t.bind(o,397,17)).then((t=>t.default))}})()})})(),a=a.component})()));